<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>Issues JSON API</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
      background: #0d1117;
      color: #c9d1d9;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
    }
    
    h1 {
      color: #61dafb;
      font-size: 2.5em;
      margin-bottom: 10px;
      background: linear-gradient(90deg, #61dafb, #21d4fd);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .subtitle {
      color: #a8bfc1;
      font-size: 1.1em;
      margin-bottom: 30px;
    }
    
    .section {
      background: #161b22;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 30px;
      border: 1px solid #2d3748;
    }
    
    .section h2 {
      color: #e94560;
      font-size: 1.5em;
      margin-bottom: 15px;
    }
    
    code {
      background: #374151;
      color: #e94560;
      padding: 3px 8px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
    }
    
    pre {
      background: #0d1117;
      border: 1px solid #2d3748;
      border-radius: 8px;
      padding: 20px;
      overflow-x: auto;
      color: #a5f3fc;
      font-size: 0.9em;
      line-height: 1.6;
    }
    
    .code-inline {
      display: block;
      background: #374151;
      color: #e94560;
      padding: 15px;
      border-radius: 6px;
      margin: 15px 0;
      font-size: 1em;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }
    
    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #2d3748;
    }
    
    th {
      color: #fbbf24;
      font-weight: 600;
    }
    
    tr:hover {
      background: #1f2937;
    }
    
    a {
      color: #61dafb;
      text-decoration: none;
    }
    
    a:hover {
      text-decoration: underline;
    }
    
    .back-link {
      display: inline-block;
      margin-top: 20px;
      padding: 10px 30px;
      background: linear-gradient(135deg, #21d4fd, #5b21b6);
      color: white;
      text-decoration: none;
      border-radius: 6px;
      font-weight: 500;
      transition: transform 0.2s;
    }
    
    .back-link:hover {
      transform: translateY(-2px);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸš€ Gwitter Issues JSON API</h1>
    <p class="subtitle">é€šè¿‡ API æ¥å£è·å– Gwitter çš„ Issues æ•°æ®ï¼Œæ–¹ä¾¿åœ¨å…¶ä»–é¡¹ç›®ä¸­ä½¿ç”¨</p>
    
    <div class="section">
      <h2>ğŸ“¡ API ç«¯ç‚¹</h2>
      <p>è®¿é—®ä»¥ä¸‹ URL è·å– Issues JSON æ•°æ®ï¼š</p>
      <div class="code-inline">
        <code>/issues.json?format=json</code>
      </div>
    </div>
    
    <div class="section">
      <h2>ğŸ“‹ å“åº”æ ¼å¼ç¤ºä¾‹</h2>
      <pre>{
  "repository": "owner/repo",
  "exportedAt": "2024-01-01T00:00:00.000Z",
  "totalIssues": 10,
  "issues": [
    {
      "id": "issue_id",
      "number": 1,
      "title": "Issue æ ‡é¢˜",
      "createdAt": "2024-01-01T00:00:00.000Z",
      "author": {
        "login": "username",
        "avatarUrl": "https://avatars.githubusercontent.com/...",
        "url": "https://github.com/..."
      },
      "reactions": {
        "totalCount": 5,
        "userReacted": true,
        "heartCount": 5
      },
      "comments": 3,
      "label": {
        "name": "label_name",
        "color": "#ffffff"
      },
      "url": "https://github.com/..."
    }
  ]
}</pre>
    </div>
    
    <div class="section">
      <h2>ğŸ’¡ ä½¿ç”¨æ–¹æ³•</h2>
      <table>
        <tr>
          <th>è¯­è¨€</th>
          <th>ä»£ç </th>
        </tr>
        <tr>
          <td>JavaScript (Fetch)</td>
          <td><pre>fetch('/issues.json?format=json')
  .then(res => res.text())
  .then(jsonText => JSON.parse(jsonText))
  .then(data => console.log(data));</pre></td>
        </tr>
        <tr>
          <td>JavaScript (async/await)</td>
          <td><pre>const response = await fetch('/issues.json?format=json');
const jsonText = await response.text();
const data = JSON.parse(jsonText);
console.log(data);</pre></td>
        </tr>
        <tr>
          <td>cURL</td>
          <td><code>curl "/issues.json?format=json"</code></td>
        </tr>
      </table>
    </div>
    
    <div class="section">
      <h2>ğŸ“ æ•°æ®æ›´æ–°</h2>
      <p>API æ¥å£ä»ä»¥ä¸‹æ¥æºè·å–æ•°æ®ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰ï¼š</p>
      <ol>
        <li><strong>localStorage</strong> - è‡ªåŠ¨ä¿å­˜çš„æœ€æ–°æ•°æ®ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰</li>
        <li><strong>ä¸»é¡µé¢</strong> - å¦‚æœåœ¨ Gwitter ä¸»é¡µåŠ è½½è¿‡æ•°æ®ï¼Œä¼šè‡ªåŠ¨åŒæ­¥</li>
      </ol>
      <p>æ›´æ–°æ•°æ®çš„æ–¹æ³•ï¼š</p>
      <ul>
        <li>æ‰“å¼€ Gwitter ä¸»é¡µï¼Œç­‰å¾… Issues åŠ è½½å®Œæˆ</li>
        <li>ç‚¹å‡»å·¥å…·æ çš„ "JSON" æŒ‰é’®ï¼Œæ‰‹åŠ¨è§¦å‘æ•°æ®æ›´æ–°</li>
      </ul>
    </div>
    
    <a href="/" class="back-link">â† è¿”å› Gwitter</a>
  </div>

  <script>
    // ä» localStorage æˆ– postMessage è·å– issues æ•°æ®
    function getIssuesData() {
      return new Promise((resolve) => {
        // ä¼˜å…ˆä» localStorage è·å–
        const storedData = localStorage.getItem('gwitter_issues_data');
        if (storedData) {
          try {
            const parsedData = JSON.parse(storedData);
            // éªŒè¯æ•°æ®æ ¼å¼
            if (parsedData && parsedData.issues && Array.isArray(parsedData.issues)) {
              resolve(parsedData);
              return;
            }
          } catch (e) {
            console.error('Failed to parse stored data:', e);
          }
        }

        // å°è¯•ä»çˆ¶çª—å£è·å–
        if (window.opener && window.opener.gwitterIssuesData) {
          resolve(window.opener.gwitterIssuesData);
          return;
        }

        // å¦‚æœéƒ½æ²¡æœ‰ï¼Œè¿”å› null
        resolve(null);
      });
    }

    // æ£€æµ‹æ˜¯å¦æ˜¯ JSON è¯·æ±‚
    const urlParams = new URLSearchParams(window.location.search);
    const format = urlParams.get('format');

    // å¦‚æœè¯·æ±‚ JSON æ ¼å¼æˆ–ç›´æ¥è®¿é—® .json æ–‡ä»¶
    if (format === 'json' || window.location.pathname.endsWith('.json')) {
      getIssuesData().then(data => {
        if (data && data.issues && data.issues.length > 0) {
          // è®¾ç½®æ­£ç¡®çš„ Content-Typeï¼ˆé€šè¿‡ meta æ ‡ç­¾ï¼‰
          const meta = document.createElement('meta');
          meta.setAttribute('http-equiv', 'Content-Type');
          meta.setAttribute('content', 'application/json; charset=utf-8');
          document.head.appendChild(meta);
          
          // æ¸…ç©º body
          document.body.innerHTML = '';
          
          // åˆ›å»º pre æ ‡ç­¾æ˜¾ç¤º JSON
          const pre = document.createElement('pre');
          pre.style.cssText = 'margin:0;padding:20px;font-family:monospace;font-size:14px;line-height:1.5;color:#a5f3fc;background:#0d1117;word-wrap:break-word;white-space:pre-wrap;';
          pre.textContent = JSON.stringify(data, null, 2);
          document.body.appendChild(pre);
          
          // è®¾ç½® document title
          document.title = `Gwitter Issues - ${data.repository}`;
        } else {
          // æ— æ•°æ®æ—¶æ˜¾ç¤ºæç¤º
          document.body.innerHTML = `
            <div class="container">
              <h1 style="color:#fbbf24;text-align:center;">âŒ No Data Available</h1>
              <p class="subtitle" style="text-align:center;">è¯·å…ˆæ‰“å¼€ Gwitter ä¸»é¡µåŠ è½½ Issues æ•°æ®</p>
              <div class="section">
                <p>è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š</p>
                <ol style="margin-left:20px;line-height:2;">
                  <li>æ‰“å¼€ Gwitter ä¸»é¡µ</li>
                  <li>ç­‰å¾… Issues åŠ è½½å®Œæˆ</li>
                  <li>ç‚¹å‡»å·¥å…·æ çš„ "JSON" æŒ‰é’®</li>
                  <li>é‡æ–°è®¿é—®æ­¤ API æ¥å£</li>
                </ol>
              </div>
              <a href="/" class="back-link">â† è¿”å› Gwitter</a>
            </div>
          `;
        }
      });
    } else {
      // æ˜¾ç¤ºä½¿ç”¨è¯´æ˜ï¼ˆé»˜è®¤æƒ…å†µï¼‰
      // é¡µé¢å·²ç»åœ¨ä¸Šé¢çš„ HTML ä¸­æ¸²æŸ“äº†
    }
  </script>
</body>
</html>
